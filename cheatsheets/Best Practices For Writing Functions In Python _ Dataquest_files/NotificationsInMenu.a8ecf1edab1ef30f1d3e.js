(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{1537:function(e,t,n){e.exports={header:"NotificationItem__header",read:"NotificationItem__read",message:"NotificationItem__message"}},1539:function(e,t,n){e.exports={root:"NotificationPanel__root",notifications:"NotificationPanel__notifications",options:"NotificationPanel__options"}},1541:function(e,t,n){},1547:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"mark_as_read",function(){return G}),n.d(r,"mark_all",function(){return H}),n.d(r,"connect_notifications",function(){return L});var o=n(0),i=n.n(o),a=n(1),c=n.n(a),s=n(6),u=n(3),f=n(2),l=n.n(f),p=(n(1541),n(142)),d=(n(1539),n(1537),n(295)),_=n(32),m=n(112),b=n.n(m),y=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var v=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,i=Array(o),a=0;a<o;a++)i[a]=arguments[a];return n=r=h(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),r._mark_as_read=function(e){r.props.mark_as_read(r.props.id)},h(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.a.PureComponent),y(t,[{key:"render",value:function(){var e=Boolean(this.props.read);return i.a.createElement("div",null,i.a.createElement("div",{className:"NotificationItem__header"},i.a.createElement(b.a,{datetime:this.props.created}),i.a.createElement(_.a,{className:"NotificationItem__read",onDark:!0,plainText:!0,icon:"pass",title:e?"Already read":"Mark as read",onClick:this._mark_as_read,disabled:e,selected:e})),i.a.createElement(d.a,{className:"NotificationItem__message",source:this.props.message}))}}]),t}();v.propTypes={id:c.a.string.isRequired,read:c.a.oneOfType([c.a.bool,c.a.string]).isRequired,created:c.a.string.isRequired,message:c.a.string.isRequired,mark_as_read:c.a.func.isRequired},v.defaultProps={},v.displayName="NotificationItem";var g=v,O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},k=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function w(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var j=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),c=0;c<o;c++)a[c]=arguments[c];return n=r=w(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.render_note=function(e){return i.a.createElement(g,O({key:e.id},e,{mark_as_read:r.props.mark_as_read}))},w(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.a.PureComponent),k(t,[{key:"render_notifications",value:function(){return 0===this.props.notifications.length?i.a.createElement("div",null,"No notifications"):this.props.notifications.map(this.render_note)}},{key:"render",value:function(){return i.a.createElement("div",{className:"NotificationPanel__root"},i.a.createElement("div",{className:"NotificationPanel__notifications"},this.render_notifications()),i.a.createElement("div",{className:"NotificationPanel__options"},i.a.createElement(_.a,{onDark:!0,toolbar:!0,text:"Mark all as Read",onClick:this.props.mark_all})))}}]),t}();j.propTypes={notifications:c.a.array.isRequired,mark_as_read:c.a.func.isRequired,mark_all:c.a.func.isRequired},j.defaultProps={},j.displayName="NotificationPanel";var P=j,N=n(13),E=n.n(N),R=n(9),q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};var T={notifications:{}},I=Object(R.make_simple_selectors)(T,"notifications_info"),x=q({},I,{notifications:Object(u.createSelector)(I.notifications,function(e){var t=Date.now()-6048e5;return l.a.chain(e).filter(function(e){var n=e.read;return!1===n||!0===n||Date.parse(n)>t}).sortBy("created").reverse().value()}),unread_count:Object(u.createSelector)(I.notifications,function(e){return l.a.filter(e,{read:!1}).length})}),C={reset:function(){return E()(T)}};function S(e){return{id:l.a.toString(e.id),created:e.created,read:e.seen||!1,message:e.message||l.a.get(e.data,"message")}}var A={add_notifications:function(e,t){var n=t.payload;return e.merge({notifications:n.reduce(function(e,t){return e[(t=S(t)).id]=t,e},{})},{deep:!0})},add_notification_ws:function(e,t){var n=S(t.payload);return e.merge({notifications:function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},n.id,n)},{deep:!0})},set_read:function(e,t){var n=t.payload;return e.merge({notifications:n.reduce(function(e,t){return e[t]={read:!0},e},{})},{deep:!0})}},M=Object(R.make_reducer_n_actions)({public_handlers:C,private_handlers:A,action_types_prefix:"notifications_info/",initial_state:T,Immutable:E.a}),D=M.reducer,B=M.private_actions,J=M.actions,W=M.ACTION_TYPES,Y=D,z=n(8),F=n(33),G=function(e){return function(t,n){return K([e])(t,n)}},H=function(e){return function(e,t){var n=l.a.map(l.a.filter(x.notifications(t()),{read:!1}),"id");return K(n)(e,t)}},K=function(e){return function(t,n){var r={seen:e};return Object(z.b)("/api/v2/notifications/notifications/seen/",{post_obj:r}).then(function(n){t(B.set_read(e))}).catch(console.error)}},L=function(){return function(e,t){return e(F.a.add_type_mappings({"push/notifications":W.add_notification_ws})),Object(z.b)("/api/v2/notifications/notifications/").then(function(t){e(B.add_notifications(t))}).catch(console.error)}},Q=n(16),U=Object.assign({},J,r),V=(Object(Q.a)({notifications_info:Y}),n(4));n.d(t,"selectors",function(){return $}),n.d(t,"actions",function(){return ee}),n.d(t,"NotificationsInMenu",function(){return ne});var X=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function Z(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var $=(Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e})({},x,{is_logged_in:V.b.is_logged_in}),ee=U,te=Object(u.createStructuredSelector)($),ne=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,a=Array(o),c=0;c<o;c++)a[c]=arguments[c];return n=r=Z(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),r.render_selector=function(){return i.a.createElement("i",{className:"material-icons",style:{width:"24px",color:"#92A2B7",margin:"0 8px"}},"notifications_none")},Z(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.a.PureComponent),X(t,[{key:"componentWillMount",value:function(){this.check_to_connect(this.props,{})}},{key:"componentWillReceiveProps",value:function(e){this.check_to_connect(e,this.props)}},{key:"check_to_connect",value:function(e,t){e.is_logged_in&&!t.is_logged_in&&e.connect_notifications()}},{key:"render",value:function(){return i.a.createElement(p.a,{dropdown:i.a.createElement(P,l.a.pick(this.props,["notifications","mark_as_read","mark_all"])),selector:this.render_selector()})}}]),t}();ne.propTypes={is_logged_in:c.a.bool.isRequired,notifications:c.a.array.isRequired,unread_count:c.a.number.isRequired,mark_as_read:c.a.func.isRequired,mark_all:c.a.func.isRequired,connect_notifications:c.a.func.isRequired},ne.displayName="NotificationsInMenu";t.default=Object(s.b)(te,ee)(ne)}}]);
//# sourceMappingURL=NotificationsInMenu.a8ecf1edab1ef30f1d3e.js.map